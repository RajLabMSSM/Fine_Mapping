"use strict";if("undefined"==typeof gwasCredibleSets)throw new Error("The standalone gwas-credible-sets library is required to use this extension");!function(){var e,a;LocusZoom.ext.Data||(LocusZoom.ext.Data={}),LocusZoom.ext.Data.CredibleSetLZ=LocusZoom.Data.Source.extend(function(e){this.parseInit(e),this.enableCache=!0,this.dependentSource=!0},"CredibleSetLZ"),LocusZoom.ext.Data.CredibleSetLZ.prototype.parseInit=function(e){if(this.params=e.params,!this.params.fields||!this.params.fields.log_pvalue)throw new Error("Source config for "+this.constructor.SOURCE_NAME+" must specify how to find 'fields.log_pvalue'");this.params.threshold||(this.params.threshold=.95)},LocusZoom.ext.Data.CredibleSetLZ.prototype.getCacheKey=function(e,a,o){return[e.credible_set_threshold||this.params.threshold,e.chr,e.start,e.end].join("_")},LocusZoom.ext.Data.CredibleSetLZ.prototype.fetchRequest=function(e,a){var o=this,s=e.credible_set_threshold||this.params.threshold;if(!a.body[0][o.params.fields.log_pvalue])throw new Error("Credible set source could not locate the required fields from a previous request.");var t=a.body.map(function(e){return e[o.params.fields.log_pvalue]}),i=[];try{for(var r=gwasCredibleSets.scoring.bayesFactors(t),n=gwasCredibleSets.scoring.normalizeProbabilities(r),c=gwasCredibleSets.marking.findCredibleSet(r,s),l=gwasCredibleSets.marking.rescaleCredibleSet(c),d=gwasCredibleSets.marking.markBoolean(c),p=0;p<a.body.length;p++)i.push({posterior_prob:n[p],contrib_fraction:l[p],is_member:d[p]})}catch(e){console.error(e)}return Q.when(i)},LocusZoom.ext.Data.CredibleSetLZ.prototype.combineChainBody=function(e,a,o,s,t){for(var i=0;i<e.length;i++){var r=e[i],n=a.body[i];Object.keys(r).forEach(function(e){n[e]=r[e]})}return a.body},LocusZoom.Layouts.add("tooltip","association_credible_set",((e=LocusZoom.Layouts.get("tooltip","standard_association",{unnamespaced:!0})).html+="<br>Posterior probability: <strong>{{{{namespace[credset]}}posterior_prob|scinotation}}</strong>",e)),LocusZoom.Layouts.add("tooltip","annotation_credible_set",{namespace:{assoc:"assoc",credset:"credset"},closable:!0,show:{or:["highlighted","selected"]},hide:{and:["unhighlighted","unselected"]},html:"<strong>{{{{namespace[assoc]}}variant}}</strong><br>P Value: <strong>{{{{namespace[assoc]}}log_pvalue|logtoscinotation}}</strong><br><br>Posterior probability: <strong>{{{{namespace[credset]}}posterior_prob|scinotation}}</strong>"}),LocusZoom.Layouts.add("data_layer","association_credible_set",LocusZoom.Layouts.get("data_layer","association_pvalues",{unnamespaced:!0,id:"associationcredibleset",namespace:{assoc:"assoc",credset:"credset",ld:"ld"},fill_opacity:.7,tooltip:LocusZoom.Layouts.get("tooltip","association_credible_set",{unnamespaced:!0}),fields:["{{namespace[assoc]}}variant","{{namespace[assoc]}}position","{{namespace[assoc]}}log_pvalue","{{namespace[assoc]}}log_pvalue|logtoscinotation","{{namespace[assoc]}}ref_allele","{{namespace[credset]}}posterior_prob","{{namespace[credset]}}contrib_fraction","{{namespace[credset]}}is_member","{{namespace[ld]}}state","{{namespace[ld]}}isrefvar"]})),LocusZoom.Layouts.add("data_layer","annotation_credible_set",{namespace:{assoc:"assoc",credset:"credset"},id:"annotationcredibleset",type:"annotation_track",id_field:"{{namespace[assoc]}}variant",x_axis:{field:"{{namespace[assoc]}}position"},color:"#00CC00",fields:["{{namespace[assoc]}}variant","{{namespace[assoc]}}position","{{namespace[assoc]}}log_pvalue","{{namespace[credset]}}posterior_prob","{{namespace[credset]}}contrib_fraction","{{namespace[credset]}}is_member"],filters:[["{{namespace[credset]}}is_member",!0]],behaviors:{onmouseover:[{action:"set",status:"highlighted"}],onmouseout:[{action:"unset",status:"highlighted"}],onclick:[{action:"toggle",status:"selected",exclusive:!0}],onshiftclick:[{action:"toggle",status:"selected"}]},tooltip:LocusZoom.Layouts.get("tooltip","annotation_credible_set",{unnamespaced:!0}),tooltip_positioning:"top"}),LocusZoom.Layouts.add("panel","annotation_credible_set",{id:"annotationcredibleset",title:{text:"SNPs in 95% credible set",x:50,style:{"font-size":"14px"}},width:800,height:100,min_height:100,proportional_width:1,margin:{top:35,right:50,bottom:40,left:50},inner_border:"rgb(210, 210, 210)",dashboard:LocusZoom.Layouts.get("dashboard","standard_panel",{unnamespaced:!0}),interaction:{drag_background_to_pan:!0,scroll_to_zoom:!0,x_linked:!0},data_layers:[LocusZoom.Layouts.get("data_layer","annotation_credible_set",{unnamespaced:!0})]}),LocusZoom.Layouts.add("panel","association_credible_set",((a=LocusZoom.Layouts.get("panel","association",{unnamespaced:!0,id:"associationcrediblesets",namespace:{assoc:"assoc",credset:"credset"},data_layers:[LocusZoom.Layouts.get("data_layer","significance",{unnamespaced:!0}),LocusZoom.Layouts.get("data_layer","recomb_rate",{unnamespaced:!0}),LocusZoom.Layouts.get("data_layer","association_credible_set",{unnamespaced:!0})]})).dashboard.components.push({type:"display_options",position:"right",color:"blue",button_html:"Display options...",button_title:"Control how plot items are displayed",layer_name:"associationcredibleset",default_config_display_name:"Linkage Disequilibrium (default)",options:[{display_name:"95% credible set (boolean)",display:{point_shape:"circle",point_size:40,color:{field:"{{namespace[credset]}}is_member",scale_function:"if",parameters:{field_value:!0,then:"#00CC00",else:"#CCCCCC"}},legend:[{shape:"circle",color:"#00CC00",size:40,label:"In credible set",class:"lz-data_layer-scatter"},{shape:"circle",color:"#CCCCCC",size:40,label:"Not in credible set",class:"lz-data_layer-scatter"}]}},{display_name:"95% credible set (gradient by contribution)",display:{point_shape:"circle",point_size:40,color:[{field:"{{namespace[credset]}}contrib_fraction",scale_function:"if",parameters:{field_value:0,then:"#777777"}},{scale_function:"interpolate",field:"{{namespace[credset]}}contrib_fraction",parameters:{breaks:[0,1],values:["#fafe87","#9c0000"]}}],legend:[{shape:"circle",color:"#777777",size:40,label:"No contribution",class:"lz-data_layer-scatter"},{shape:"circle",color:"#fafe87",size:40,label:"Some contribution",class:"lz-data_layer-scatter"},{shape:"circle",color:"#9c0000",size:40,label:"Most contribution",class:"lz-data_layer-scatter"}]}}]}),a)),LocusZoom.Layouts.add("plot","association_credible_set",{state:{},width:800,height:450,responsive_resize:"both",min_region_scale:2e4,max_region_scale:1e6,dashboard:LocusZoom.Layouts.get("dashboard","standard_plot",{unnamespaced:!0}),panels:[LocusZoom.Layouts.get("panel","association_credible_set",{unnamespaced:!0}),LocusZoom.Layouts.get("panel","annotation_credible_set",{unnamespaced:!0}),LocusZoom.Layouts.get("panel","genes",{unnamespaced:!0})]})}();
//# sourceMappingURL=lz-credible-sets.min.js.map

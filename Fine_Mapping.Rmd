---
title: "<center>Fine Mapping:<br>Parkinson's Disease & Alzheimer's Disease</center>" 
author: 
    "<div class='container'>
     <h3>Brian M. Schilder, Bioinformatician II<br>
     Raj Lab<br>
     Department of Neuroscience<br>
     Icahn School of Medicine at Mount Sinai<br>
     NYC, New York<br>
     </h3> 
     
     <a href='https://github.com/RajLabMSSM'><img src='./web/images/github.png'></a> 
     <a class='item' href='https://rajlabmssm.github.io/RajLab_website/'>
        <img src='./web/images/brain-icon.png'>
        <span class='caption'>RAJ LAB</span>
     <a href='https://icahn.mssm.edu/'><img src='./web/images/sinai.png'></a>
     </div>"
date: "`r Sys.Date()`"
output:
 html_document:
    theme: cerulean
    highlight: zenburn
    code_folding: show
    toc: true
    toc_float: true
    smooth_scroll: true
    number_sections: false
    self_contained: true
    css: ./web/css/style.css
editor_options: 
  chunk_output_type: inline
--- 

# Setup

```{r setup, message=F, warning=F, dpi = 600}
# devtools::install_local("geneRefineR/", force = T)
# library("geneRefineR") 
source("geneRefineR/R/functions.R")

# MINERVA PATHS TO SUMMARY STATISTICS DATASETS:
## Local path
Data_dir = "Data"
## MESA eQTLs
Data_dir = "/hpc/users/rajt01/ad-omics/data/mesa"
## Nalls et al. (2019) GWAS
Data_dir = "/hpc/users/rajt01/pd-omics/gwas"
## 23andMe Parkinson's GWAS
Data_dir = "/hpc/users/rajt01/pd-omics/data/nallsEtAl2019/23andme"
## IGAP & Marion et al. (2018) Alzheimer's GWAS's
Data_dir = "/hpc/users/rajt01/ad-omics/data/AD_GWAS/latest"


library(readxl)
library(DT)
library(data.table)
library(dplyr)
library(ggplot2)
library(plotly)
library(cowplot)
library(ggrepel)
library(curl)
library(biomaRt)
library(sqldf)
# Ensembl LD API
library(httr)
library(jsonlite)
library(xml2)
library(gaston)
library(RCurl)

# *** susieR ****
# library(knitrBootstrap) #install_github('jimhester/knitrBootstrap')
library(susieR) # devtools::install_github("stephenslab/susieR")


sessionInfo()
print(paste("susieR ", packageVersion("susieR")))
```

## Finemap PD Genes: Nalls (2018) {.tabset .tabset-fade .tabset-pills}

```{r Finemap PD Genes: Nalls (2018), results = 'asis', fig.height=8, fig.width=7} 
list[top_SNPs, SumStats_sig] <- import_sig_GWAS(
  file_path = file.path(Data_dir,"/Parkinsons/Nalls2018_S2_SummaryStats.xlsx"),
  sheet="Data",
  chrom_col = "CHR", position_col = "BP", snp_col="SNP",
  pval_col="P, all studies", effect_col="Beta, all studies", gene_col="Nearest Gene",
  caption= "Nalls et al. (2018) PD GWAS Summary Stats")


finemapped_PD <- finemap_geneList(top_SNPs, geneList=c("LRRK2","GBAP1","SNCA","VPS13C","GCH1"), #unique(top_SNPs$Gene) 
                 filePath="Data/Parkinsons/META.PD.NALLS2014.PRS.tsv",
                  snp_col = "MarkerName", pval_col = "P.value")
```

## Finemap AD Genes: Posthuma (2019) {.tabset .tabset-fade .tabset-pills}

```{r Finemap AD Genes: Posthuma (2019) , results = 'asis', fig.height=8, fig.width=7} 
list[top_SNPs, SumStats_sig] <- import_sig_GWAS(
  file_path = file.path(Data_dir,"Alzheimers/Posthuma/AD_target_SNP.xlsx"),
  sheet = 3,
  chrom_col = "Chr", position_col = "bp", snp_col="SNP",
  pval_col="P", effect_col="Z", gene_col="Gene",
  caption= "Posthuma et al. (2018) AD GWAS Summary Stats")


finemapped_AD <- finemap_geneList(top_SNPs, geneList=c("CLU/PTK2B","APOE"),
                 filePath="Data/Alzheimers/Posthuma/phase3.beta.se.hrc.txt",
                  effect_col = "BETA", stderr_col = "SE", position_col = "BP")
```

## Finemap AD Genes: IGAP {.tabset .tabset-fade .tabset-pills}

```{r Finemap AD Genes: IGAP, results = 'asis', fig.height=8, fig.width=7} 
list[top_SNPs, SumStats_sig] <- import_sig_GWAS(
  file_path = file.path(Data_dir,"Alzheimers/IGAP/Lambert_2019_AD_GWAS.xlsx"),
  sheet = 1,
  chrom_col = "CHR", position_col = "Position", snp_col="SNP",
  pval_col="Overall_P", effect_col="Overall_OR", gene_col="Closest gene",
  caption= "IGAP: AD GWAS Summary Stats")
# genes <- snps_to_genes(snp_list=top_SNPs$SNP )

finemapped_AD <- finemap_geneList(top_SNPs, geneList=c("PTK2B"), 
                   filePath=file.path(Data_dir,"Alzheimers/IGAP/IGAP_stage_1.1000G.phase3.20130502.tsv"),
                   chrom_col = "CHROM",  pval_col = "PVAL",snp_col = "ID",
                    effect_col = "BETA", stderr_col = "SE", position_col = "POS")
```


